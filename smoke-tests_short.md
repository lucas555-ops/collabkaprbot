## Patch Series 05–08 — Collab Girls (SHORT)

> Быстрый прогон (10–20 минут): проверяем «золотые пути».
>
> Хак для ускорения теста лимитов (временно в env):
> - INTRO_DAILY_LIMIT=2, INTRO_DAILY_LIMIT_UNVERIFIED=1
> - WORKSPACE_FOLDER_MAX_ITEMS_FREE=2, GIVEAWAY_SPONSORS_MAX_FREE=2
> Потом верни значения назад.

### 0) Предусловия
- Применены миграции: 014, 015, 016, 019.
- Бот живой, inline-кнопки кликаются.
- Команда /paysupport отвечает (контакт поддержки по оплатам).
- Есть аккаунты: Owner и второй аккаунт (Editor) для инвайта.
- У Owner создан Workspace.
 - Для проверки rate-limit: выставь RATE_LIMIT_ENABLED=true (и лимиты BX_MSG_RATE_LIMIT/INTRO_RATE_LIMIT при желании).

### 1) Commit 05 — Intro trial + daily limits
1. Под брендом/байером открой offer → нажми «💬 Диалог/Написать».
   - Ожидаемо: интро создаётся; если кредитов не хватало и trial ещё не был выдан — выдаётся trial и списывается cost.
2. Повтори интро до упора лимита.
   - Ожидаемо: при превышении лимита — alert про лимит / paywall.
3. Попробуй ещё раз.
   - Ожидаемо: интро НЕ создаётся, списаний нет.

### 2) Commit 06 — Proofs
1. В thread нажми «🧾 Proofs: N».
2. «🔗 Ссылка» → отправь https://t.me/... → проверь, что N вырос.
3. «📎 Скрин» → отправь фото → проверь, что proof добавился.

### 3) Commit 07 — CRM stage display
1. В thread выстави CRM стадию (доступно в Brand Plan).
   - Ожидаемо: вверху видно CRM: ...
2. Вернись в Inbox.
   - Ожидаемо: у треда появился emoji стадии.

### 4) Commit 08 — Folders + Editors + integrations
#### 4.1 Папки (Owner)
1. Workspace → «📁 Папки» → создай папку → добавь @каналы списком.
2. «Экспорт/Список» → бот выдаёт список @каналов.

#### 4.2 Editors (Owner → Editor)
1. «📁 Папки» → «👥 Editors» → Invite editor.
2. Открой deep-link на аккаунте Editor (/start fed_...).
3. Под Editor зайди в «📁 Папки» → добавь/удали 1 канал.

#### 4.3 Giveaways sponsors from folder
1. Создай конкурс → шаг Sponsors → «📁 Из папки» → выбери папку.
   - Ожидаемо: sponsors подставились; если лимит превышен — предупреждение.

#### 4.4 Offer partner folder
1. Создай offer → прикрепи папку партнёров.
   - Ожидаемо: в карточке оффера видно название папки и кол-во.

### 5) P1 Commit 05 — Rate limit enforcement (thread + intro)
1. Включи RATE_LIMIT_ENABLED=true.
2. Открой любой thread → «💬 Ответить» → быстро отправь 15 сообщений за 1 минуту.
   - Ожидаемо: после лимита бот отвечает «⏳ Слишком часто...», и повторная отправка после паузы проходит.
3. В ленте офферов нажми «💬 Написать» много раз подряд.
   - Ожидаемо: alert «⏳ Слишком часто...», при этом кредиты не списываются.



6) Presets: в «Новый конкурс» нажми «🧩 Пресеты» → применить → попадаешь на выбор призовых мест. В «Новый оффер» нажми «🧩 Шаблоны» → применить → шаг 4/4 (текст).


### 7) Commit 08 — Verification incentives (paywall CTA)
1. Под брендом нажми «💬 Написать» по офферу так, чтобы открылся paywall.
   - Ожидаемо: есть строка про верификацию (лимит станет выше) и кнопка «✅ Увеличить лимит (верификация)».
2. Нажми кнопку → попадаешь в «✅ Верификация».
   - Ожидаемо: на экране есть блок «Преимущества» (для Brand/Creator).
### 6) Retry credits (fairness)
- В env (на тест): INTRO_RETRY_ENABLED=true, INTRO_RETRY_AFTER_HOURS=0, INTRO_RETRY_EXPIRES_DAYS=1
- Brand: открой интро и отправь 1 сообщение в тред.
- Не отвечай со стороны Creator.
- Запусти cron tick (api/cron/giveaways-tick) → Brand должен получить уведомление и Retry credits увеличится на 1.
- Открой новое интро → должно открыться без списания Brand Pass (увидишь alert «Использован Retry credit»).

- Проверь Brand Inbox: у треда отображается статус «⏳ waiting reply…» и строка retry (eligible/in ...h).
- Открой тред (#id): в шапке видно Reply/Retry и строку «💳 Списано: …». Кнопка «ℹ️ Retry» показывает правила.
